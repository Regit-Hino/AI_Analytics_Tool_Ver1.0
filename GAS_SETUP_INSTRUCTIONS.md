# Google Apps Script セットアップ手順

## 1. Google Apps Scriptプロジェクトの作成

1. [Google Apps Script](https://script.google.com/)にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「AI診断データ収集」に変更

## 2. コードの設定

1. デフォルトの`myFunction`を削除
2. `gas-code.js`の内容をすべてコピー
3. Google Apps Scriptエディタに貼り付け
4. **重要**: コード内の`YOUR_SPREADSHEET_ID`を実際のスプレッドシートIDに置き換える
   - スプレッドシートのURLから取得: `https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}/edit`

## 3. スプレッドシートの準備

1. Google スプレッドシートを新規作成または既存のものを使用
2. シート名を「回答一覧」に変更（重要！）
3. スプレッドシートIDをコピー

## 4. デプロイ手順

1. Google Apps Scriptエディタで「デプロイ」→「新しいデプロイ」
2. 歯車アイコンをクリック→「ウェブアプリ」を選択
3. 以下の設定を行う：
   - **説明**: AI診断データ収集 v1
   - **実行するユーザー**: 自分（あなたのアカウント）
   - **アクセスできるユーザー**: 全員（重要！）
4. 「デプロイ」をクリック
5. 初回は権限の承認が必要：
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「安全でないページに移動」
   - 「許可」をクリック
6. 表示されたウェブアプリのURLをコピー

## 5. URLのテスト

1. コピーしたURLをブラウザで開く
2. 以下のようなJSONが表示されれば成功：
```json
{
  "status": "ok",
  "message": "Google Apps Script is working correctly",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## 6. アプリケーションの設定

1. `.env`ファイルを作成（`.env.example`をコピー）
2. `VITE_SAVE_ENDPOINT`にコピーしたURLを設定：
```
VITE_SAVE_ENDPOINT=https://script.google.com/macros/s/{YOUR_SCRIPT_ID}/exec
```

## 7. 動作確認

1. アプリケーションを起動
2. 診断を完了
3. 結果画面で「テスト送信」ボタンをクリック（開発環境のみ表示）
4. スプレッドシートにデータが追加されているか確認

## トラブルシューティング

### 「スクリプト関数が見つかりません: doGet」エラー
- `doGet`関数がコードに含まれているか確認
- 保存（Ctrl+S）してから再デプロイ

### 401 Unauthorizedエラー
- 「アクセスできるユーザー」が「全員」になっているか確認
- URLが最新のデプロイのものか確認

### データが保存されない
1. Google Apps Scriptの「実行数」でログを確認
2. スプレッドシートIDが正しいか確認
3. シート名が「回答一覧」になっているか確認

### CORSエラー
- これは正常です（`no-cors`モードを使用しているため）
- ネットワークタブでリクエストが送信されているか確認

## セキュリティについて

- 実行ユーザーを「自分」に設定することで、スプレッドシートへのアクセスはあなたのアカウント権限で行われます
- 「全員」からのアクセスを許可しても、スプレッドシート自体は公開されません
- 本番環境では、適切なアクセス制限を検討してください