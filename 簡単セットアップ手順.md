# 簡単セットアップ手順

## ステップ1: 新しいGoogle Apps Scriptプロジェクトを作成

1. このリンクを開く: https://script.google.com/home
2. 「新しいプロジェクト」ボタンをクリック
3. 左上の「無題のプロジェクト」をクリックして、名前を「AI診断データ保存」に変更

## ステップ2: コードをコピペ

1. エディタに表示されている初期コード（myFunctionなど）をすべて削除
2. 下記のコードをすべてコピーして貼り付け：

```javascript
// POSTリクエストを処理する関数
function doPost(e) {
  try {
    // リクエストボディをパース
    const data = JSON.parse(e.postData.contents);
    
    // スプレッドシートを開く
    const spreadsheetId = 'ここにスプレッドシートIDを入力'; // ← 変更する場所
    const sheet = SpreadsheetApp.openById(spreadsheetId).getSheetByName('回答一覧');
    
    // データを配列に変換
    const row = [
      data.timestamp || new Date().toISOString(),
      data.company || '',
      data.industry || '',
      data.headcount || '',
      data.name || '',
      data.email || '',
      data.answers?.q1 || data.answers?.[1] || '',
      data.answers?.q2 || data.answers?.[2] || '',
      data.answers?.q3 || data.answers?.[3] || '',
      data.answers?.q4 || data.answers?.[4] || '',
      data.answers?.q5 || data.answers?.[5] || '',
      data.answers?.q6 || data.answers?.[6] || '',
      data.answers?.q7 || data.answers?.[7] || '',
      data.answers?.q8 || data.answers?.[8] || '',
      data.answers?.q9 || data.answers?.[9] || '',
      data.answers?.q10 || data.answers?.[10] || '',
      data.answers?.q11 || data.answers?.[11] || '',
      data.answers?.q12 || data.answers?.[12] || '',
      data.answers?.q13 || data.answers?.[13] || '',
      data.answers?.q14 || data.answers?.[14] || '',
      data.answers?.q15 || data.answers?.[15] || '',
      data.total_score || 0,
      data.tier || ''
    ];
    
    // 最終行に追加
    sheet.appendRow(row);
    
    // 成功レスポンス
    return ContentService
      .createTextOutput(JSON.stringify({status: 'success'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    // エラーレスポンス
    return ContentService
      .createTextOutput(JSON.stringify({status: 'error', message: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// GETリクエストを処理する関数（テスト用）
function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({
      status: 'ok',
      message: 'Working!'
    }))
    .setMimeType(ContentService.MimeType.JSON);
}
```

## ステップ3: スプレッドシートIDを設定

1. 保存先のGoogleスプレッドシートを開く
2. URLからIDをコピー：
   ```
   https://docs.google.com/spreadsheets/d/【ここがID】/edit
   ```
3. コードの8行目の`ここにスプレッドシートIDを入力`を実際のIDに置き換え

## ステップ4: 保存してデプロイ

1. Ctrl+S（Mac: Cmd+S）で保存
2. 右上の「デプロイ」ボタンをクリック
3. 「新しいデプロイ」を選択
4. 歯車アイコンをクリック → 「ウェブアプリ」を選択
5. 以下のように設定：
   - 説明: v1（なんでもOK）
   - 実行するユーザー: **自分**
   - アクセスできるユーザー: **全員**
6. 「デプロイ」ボタンをクリック

## ステップ5: 権限を承認

1. 「アクセスを承認」が表示されたらクリック
2. Googleアカウントを選択
3. 「詳細」をクリック
4. 「AI診断データ保存（安全ではないページ）に移動」をクリック
5. 「許可」をクリック

## ステップ6: URLをコピー

1. デプロイが完了したら、表示されるウェブアプリのURLをコピー
2. このURLを`.env`ファイルの`VITE_SAVE_ENDPOINT=`の後ろに貼り付け

## 動作確認

1. コピーしたURLをブラウザで開く
2. `{"status":"ok","message":"Working!"}`が表示されればOK！

## よくある問題

- **「シートが見つかりません」エラー**: スプレッドシートのシート名を「回答一覧」にする
- **「権限がありません」エラー**: スプレッドシートIDが正しいか確認
- **何も表示されない**: URLが正しいか、デプロイが完了しているか確認